<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾‹å¸« AI æ¡ˆæƒ…è¨ºæ–·å®¤ (Pro)</title>
    <style>
        :root { --legal-blue: #1a2a6c; --bg: #f5f7fa; --success: #27ae60; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 20px; box-sizing: border-box; }
        .container { max-width: 600px; margin: 0 auto; padding-bottom: 60px; }
        .header { text-align: center; color: var(--legal-blue); margin-bottom: 20px; }
        
        /* å¡ç‰‡é€šç”¨æ¨£å¼ */
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.08); margin-bottom: 20px; transition: 0.3s; }
        
        /* è¼¸å…¥å€èˆ‡ç·¨è¼¯å€ */
        textarea { 
            width: 100%; min-height: 120px; border: 1px solid #ddd; border-radius: 8px; padding: 12px; 
            font-size: 1rem; line-height: 1.6; box-sizing: border-box; resize: vertical; font-family: inherit;
        }
        textarea:focus { outline: none; border-color: var(--legal-blue); }
        
        /* çµæœç·¨è¼¯å€ç‰¹åˆ¥æ¨£å¼ (è®“å®ƒçœ‹èµ·ä¾†åƒæ–‡ä»¶) */
        #result-editor { 
            min-height: 300px; border-color: var(--legal-blue); background-color: #fafafa; 
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { background: var(--legal-blue); color: white; border: none; width: 100%; padding: 15px; border-radius: 30px; font-size: 1rem; font-weight: bold; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: 0.2s; }
        .btn:active { transform: scale(0.98); }
        .btn-save { background: var(--success); margin-top: 10px; }
        
        /* è¼‰å…¥å‹•ç•« */
        .loading { display: none; text-align: center; margin: 20px 0; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--legal-blue); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* éš±è—å€å¡Šæ§åˆ¶ */
        .hidden { display: none; }
        
        label { font-weight: bold; color: #555; display: block; margin-bottom: 5px; }
        input[type="text"] { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; margin-bottom: 10px; box-sizing: border-box;}
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>âš–ï¸ æ¡ˆæƒ…è¨ºæ–·èˆ‡æ­¸æª”</h1>
        </div>

        <div class="card" id="input-section">
            <label>ç•¶äº‹äººé™³è¿° / æ¡ˆæƒ…æ‘˜è¦</label>
            <textarea id="case-detail" placeholder="è«‹è¼¸å…¥äº‹å¯¦ç¶“éï¼ŒAI å°‡å”åŠ©åˆ†æçˆ­é»èˆ‡ç­–ç•¥..."></textarea>
            <button class="btn" onclick="startAnalysis()">
                <span>ğŸ” é–‹å§‹åˆ†æ</span>
            </button>
        </div>

        <div class="loading" id="loading-spinner">
            <div class="spinner"></div>
            <p>AI åŠ©ç†æ­£åœ¨æ’°å¯«æ³•å¾‹æ„è¦‹æ›¸...</p>
        </div>

        <div class="card hidden" id="result-section">
            <label>ğŸ“‹ AI åˆ†æå ±å‘Š (å¯é»æ“Šä¿®æ”¹)</label>
            <textarea id="result-editor"></textarea>
            
            <hr style="border: 0; border-top: 1px dashed #ddd; margin: 20px 0;">
            
            <label>æ­¸æª”è¨­å®š</label>
            <input type="text" id="doc-filename" placeholder="è«‹è¼¸å…¥æª”æ¡ˆåç¨± (ä¾‹å¦‚ï¼šé™³å¤§æ–‡_å€Ÿæ¬¾ç³¾ç´›åˆè©•)">
            
            <button class="btn btn-save" id="btn-save-cloud" onclick="saveToDrive()">
                <span>â˜ï¸ å„²å­˜è‡³ Google Drive</span>
            </button>
            <button class="btn" style="background: #95a5a6; margin-top: 10px;" onclick="location.reload()">
                <span>ğŸ”„ æ¸…é™¤é‡ä¾†</span>
            </button>
        </div>
    </div>

    <script>
        // è¨­å®š 1ï¼šæ‚¨çš„ AI åˆ†æ Webhook (åŸæœ¬é‚£å€‹)
        const WEBHOOK_ANALYSIS = 'https://l52511.zeabur.app/webhook-test/case-analysis'; 
        
        // è¨­å®š 2ï¼šæ‚¨çš„ Google Drive å­˜æª” Webhook (æ–°åŠ çš„é‚£å€‹ path: save-to-docs)
        const WEBHOOK_SAVE = 'https://l52511.zeabur.app/webhook/save-to-docs';

        async function startAnalysis() {
            const content = document.getElementById('case-detail').value;
            if (!content) return alert("è«‹è¼¸å…¥æ¡ˆæƒ…æè¿°");

            // åˆ‡æ›ç•«é¢
            document.getElementById('input-section').classList.add('hidden');
            document.getElementById('loading-spinner').style.display = 'block';

            try {
                const response = await fetch(WEBHOOK_ANALYSIS, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ description: content })
                });
                const data = await response.json();
                
                // å–å¾— AI å›è¦†
                const aiResponse = data.analysis || data.output || "åˆ†æå®Œæˆï¼Œä½†å…§å®¹ç‚ºç©ºã€‚";

                // å¡«å…¥ç·¨è¼¯å€
                document.getElementById('result-editor').value = aiResponse;
                
                // è‡ªå‹•ç”¢ç”Ÿä¸€å€‹é è¨­æª”å (ä¾‹å¦‚ï¼šæ¡ˆæƒ…åˆ†æ_20231025)
                const dateStr = new Date().toISOString().split('T')[0];
                document.getElementById('doc-filename').value = `æ¡ˆæƒ…åˆ†æ_${dateStr}`;

                // é¡¯ç¤ºç·¨è¼¯å€
                document.getElementById('loading-spinner').style.display = 'none';
                document.getElementById('result-section').classList.remove('hidden');

            } catch (error) {
                console.error(error);
                alert("åˆ†æé€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ n8n");
                document.getElementById('loading-spinner').style.display = 'none';
                document.getElementById('input-section').classList.remove('hidden');
            }
        }

        async function saveToDrive() {
            const finalContent = document.getElementById('result-editor').value;
            const filename = document.getElementById('doc-filename').value;
            const btn = document.getElementById('btn-save-cloud');

            if (!filename) return alert("è«‹è¼¸å…¥æª”æ¡ˆåç¨±");

            // æŒ‰éˆ•è®Šæ›´ç‹€æ…‹
            const originalText = btn.innerHTML;
            btn.innerHTML = "â³ é›²ç«¯å­˜æª”ä¸­...";
            btn.disabled = true;

            try {
                // å‘¼å«ç¬¬äºŒå€‹ Webhook
                const response = await fetch(WEBHOOK_SAVE, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        content: finalContent,
                        filename: filename
                    })
                });
                
                if (response.ok) {
                    alert("âœ… æˆåŠŸï¼æ–‡ä»¶å·²å­˜å…¥æ‚¨çš„ Google Drive");
                } else {
                    alert("âŒ å­˜æª”å¤±æ•—ï¼Œè«‹æª¢æŸ¥ n8n Google Docs ç¯€é»è¨­å®š");
                }

            } catch (error) {
                console.error(error);
                alert("é€£ç·šéŒ¯èª¤");
            } finally {
                btn.innerHTML = originalText;
                btn.disabled = false;
            }
        }
    </script>
</body>
</html>
