<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾‹å¸« AI æ¡ˆæƒ…è¨ºæ–·å®¤</title>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root { --legal-blue: #1a2a6c; --bg: #f5f7fa; }
        body { font-family: "Microsoft JhengHei", sans-serif; background: var(--bg); margin: 0; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        .header { text-align: center; color: var(--legal-blue); margin-bottom: 25px; }
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); margin-bottom: 20px; }
        textarea { width: 100%; height: 150px; border: 1px solid #ddd; border-radius: 10px; padding: 10px; font-size: 1rem; box-sizing: border-box; resize: none; }
        .btn { background: var(--legal-blue); color: white; border: none; width: 100%; padding: 15px; border-radius: 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer; margin-top: 10px; }
        .btn:disabled { background: #ccc; }
        
        /* è¨ºæ–·å ±å‘Šé¡¯ç¤ºå€ */
        #result-display { display: none; }
        .report-content { line-height: 1.6; color: #333; }
        .report-content h1, .report-content h2 { color: var(--legal-blue); }
        
        /* å‹•ç•«æ•ˆæœ */
        .loading { display: none; text-align: center; margin: 20px 0; }
        .spinner { border: 4px solid #f3f3f3; border-top: 4px solid var(--legal-blue); border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

    <div class="container">
        <div class="header">
            <h1>âš–ï¸ æ¡ˆæƒ…åˆæ­¥è¨ºæ–·</h1>
            <p>è«‹è¼¸å…¥äº‹å¯¦ç¶“éï¼ŒAI åŠ©ç†å°‡é€²è¡Œåˆæ­¥æ³•å¾‹åˆ†æ</p>
        </div>

        <div class="card" id="input-section">
            <textarea id="case-detail" placeholder="ä¾‹å¦‚ï¼šæŸç”²æ–¼ 112 å¹´ 1 æœˆå‘æˆ‘å€Ÿæ¬¾ 50 è¬å…ƒï¼Œç´„å®šåŠå¹´å¾Œé‚„æ¸…ï¼Œä½†è‡³ä»Šåƒ…é‚„ 5 è¬ï¼Œä¸”è¨Šæ¯ä¸è®€ä¸å›..."></textarea>
            <button class="btn" id="analyze-btn" onclick="startAnalysis()">é–‹å§‹æ™ºæ…§åˆ†æ</button>
        </div>

        <div class="loading" id="loading-spinner">
            <div class="spinner"></div>
            <p>å¾‹å¸« AI æ­£åœ¨ç ”è®€æ¡ˆæƒ…ä¸¦æª¢ç´¢æ³•æ¢...</p>
        </div>

        <div class="card" id="result-display">
            <h2>ğŸ“‹ è¨ºæ–·å ±å‘Š</h2>
            <div id="report-body" class="report-content"></div>
            <button class="btn" style="background:#555;" onclick="location.reload()">é‡æ–°è«®è©¢</button>
        </div>
    </div>

    <script>
        async function startAnalysis() {
            const content = document.getElementById('case-detail').value;
            if (!content) return alert("è«‹è¼¸å…¥æ¡ˆæƒ…æè¿°");

            // UI ç‹€æ…‹åˆ‡æ›
            document.getElementById('input-section').style.display = 'none';
            document.getElementById('loading-spinner').style.display = 'block';

            try {
                // ä¸²æ¥æ‚¨çš„ n8n Webhook
                const response = await fetch('https://l52511.zeabur.app/webhook-test/https://jeffreylin525.github.io/case-analysis/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ description: content })
                });

                const data = await response.json();
                
                // å‡è¨­ n8n å›å‚³çš„æ¬„ä½å«åš "analysis"
                const aiResponse = data.analysis || "åˆ†æå®Œæˆï¼Œä½†ç„¡æ³•å–å¾—å…§å®¹ã€‚";

                // é¡¯ç¤ºçµæœä¸¦è§£æ Markdown
                document.getElementById('loading-spinner').style.display = 'none';
                document.getElementById('result-display').style.display = 'block';
                document.getElementById('report-body').innerHTML = marked.parse(aiResponse);

            } catch (error) {
                alert("é€£ç·šå¤±æ•—ï¼Œè«‹æª¢æŸ¥ n8n è¨­å®š");
                location.reload();
            }
        }
    </script>
</body>
</html>